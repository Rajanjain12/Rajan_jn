
CREATE TABLE GUESTMARKETINGPREFERENCES
  AS (SELECT * FROM GUESTPREFERENCES);

CREATE TABLE GUESTMARKETINGPREFERENCESRESET
  AS (SELECT * FROM GUESTPREFERENCESRESET);

ALTER TABLE `KyobeeTechRevamp`.`GUESTMARKETINGPREFERENCES` 
ADD INDEX `FK1_GUESTID_idx` (`GUEST_ID` ASC);
;
ALTER TABLE `KyobeeTechRevamp`.`USER` 
DROP COLUMN `Address`;
ALTER TABLE `KyobeeTechRevamp`.`GUESTMARKETINGPREFERENCES` 
ADD CONSTRAINT `FK1_GUESTID`
  FOREIGN KEY (`GUEST_ID`)
  REFERENCES `KyobeeTechRevamp`.`GUEST` (`guestID`)
  ON DELETE NO ACTION
  ON UPDATE NO ACTION;
  
  ALTER TABLE `KyobeeTechRevamp`.`GUESTMARKETINGPREFERENCES` 
CHANGE COLUMN `GUEST_PREF_ID` `GUEST_MARKETING_PREF_ID` INT(11) NOT NULL DEFAULT '0' ;

ALTER TABLE `KyobeeTechRevamp`.`GUESTMARKETINGPREFERENCES` 
CHANGE COLUMN `GUEST_MARKETING_PREF_ID` `GUEST_MARKETING_PREF_ID` INT(11) NOT NULL AUTO_INCREMENT ,
CHANGE COLUMN `PREF_ID` `PREF_ID` INT(11) NOT NULL ,
ADD PRIMARY KEY (`GUEST_MARKETING_PREF_ID`);
;
ALTER TABLE `KyobeeTechRevamp`.`GUESTMARKETINGPREFERENCESRESET` 
CHANGE COLUMN `GUEST_PREF_RESET_ID` `GUEST_MARKETING_PREF_RESET_ID` INT(11) NOT NULL AUTO_INCREMENT ,
CHANGE COLUMN `PREF_ID` `PREF_ID` INT(11) NOT NULL ,
ADD PRIMARY KEY (`GUEST_MARKETING_PREF_RESET_ID`);
;
ALTER TABLE `KyobeeTechRevamp`.`GUEST` 
CHANGE COLUMN `noOfPeople` `noOfPeople` INT(11) NULL DEFAULT NULL ;

UPDATE `KyobeeTechRevamp`.`LANGUAGEKEYMAPPING` SET `ScreenName` = 'seatingOrMarketingPref' WHERE (`LanguageKeyMappingId` = '15');
UPDATE `KyobeeTechRevamp`.`LANGUAGEKEYMAPPING` SET `ScreenName` = 'seatingOrMarketingPref' WHERE (`LanguageKeyMappingId` = '16');
UPDATE `KyobeeTechRevamp`.`LANGUAGEKEYMAPPING` SET `ScreenName` = 'seatingOrMarketingPref' WHERE (`LanguageKeyMappingId` = '19');
UPDATE `KyobeeTechRevamp`.`LANGUAGEKEYMAPPING` SET `ScreenName` = 'seatingOrMarketingPref' WHERE (`LanguageKeyMappingId` = '22');
UPDATE `KyobeeTechRevamp`.`LANGUAGEKEYMAPPING` SET `ScreenName` = 'seatingOrMarketingPref' WHERE (`LanguageKeyMappingId` = '24');
UPDATE `KyobeeTechRevamp`.`LANGUAGEKEYMAPPING` SET `ScreenName` = 'seatingOrMarketingPref' WHERE (`LanguageKeyMappingId` = '25');
UPDATE `KyobeeTechRevamp`.`LANGUAGEKEYMAPPING` SET `ScreenName` = 'seatingOrMarketingPref' WHERE (`LanguageKeyMappingId` = '26');
UPDATE `KyobeeTechRevamp`.`LANGUAGEKEYMAPPING` SET `ScreenName` = 'seatingOrMarketingPref' WHERE (`LanguageKeyMappingId` = '17');
UPDATE `KyobeeTechRevamp`.`LANGUAGEKEYMAPPING` SET `ScreenName` = 'seatingOrMarketingPref' WHERE (`LanguageKeyMappingId` = '18');

ALTER TABLE `KyobeeTechRevamp`.`SMSLOG` 
CHANGE COLUMN `PhoneNo` `PhoneNo` INT NULL DEFAULT NULL ;

ALTER TABLE `KyobeeTechRevamp`.`GUEST` 
CHANGE COLUMN `sms` `contactNo` INT NULL DEFAULT NULL ;

ALTER TABLE `KyobeeTechRevamp`.`GUEST` 
DROP COLUMN `marketingPreference`;

CREATE TABLE `KyobeeTechRevamp`.`ROLE` (
  `RoleId` INT(11) NOT NULL,
  `RoleName` VARCHAR(100) NULL,
  `Active` TINYINT(1) NULL,
  `CreatedBy` VARCHAR(100) NULL,
  `CreatedAt` DATE NULL,
  `ModifiedBy` VARCHAR(100) NULL,
  `ModifiedAt` DATE NULL,
  PRIMARY KEY (`RoleId`));
  
CREATE TABLE `KyobeeTechRevamp`.`ORGANIZATIONTYPE` (
  `TypeId` INT(11) NOT NULL,
  `TypeName` VARCHAR(100) NULL,
  `Active` TINYINT(1) NULL,
  `CreatedBy` VARCHAR(100) NULL,
  `CreatedAt` DATE NULL,
  `ModifiedBy` VARCHAR(100) NULL,
  `ModifiedAt` DATE NULL,
  PRIMARY KEY (`TypeId`));
  
  
ALTER TABLE `KyobeeTechRevamp`.`USERROLE` 
DROP FOREIGN KEY `FK1RoleID`;
ALTER TABLE `KyobeeTechRevamp`.`USERROLE` 
DROP INDEX `FK1RoleID` ,
ADD INDEX `FK1RoleID_idx` (`RoleID` ASC);
;
ALTER TABLE `KyobeeTechRevamp`.`USERROLE` 
ADD CONSTRAINT `FK1RoleID`
FOREIGN KEY (`RoleID`)
REFERENCES `KyobeeTechRevamp`.`ROLE` (`RoleId`);

CREATE TABLE `KyobeeTechRevamp`.`SMSTEMPLATELANGUAGEMAPPING` (
  `ID` INT NOT NULL,
  `LangId` INT NULL,
  `IsoCode` VARCHAR(10) NULL,
  `Level` INT NULL,
  `TemplateText` VARCHAR(250) NULL,
  `Active` TINYINT(1) NULL,
  `CreatedBy` VARCHAR(45) NULL,
  `CreatedAt` DATE NULL,
  `ModifiedBy` VARCHAR(45) NULL,
  `ModifiedAt` DATE NULL,
  PRIMARY KEY (`ID`),
  INDEX `FK01LangID_idx` (`LangId` ASC),
  CONSTRAINT `FK01LangID`
    FOREIGN KEY (`LangId`)
    REFERENCES `KyobeeTechRevamp`.`LANGMASTER` (`LangID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION);


ALTER TABLE `KyobeeTechRevamp`.`ORGANIZATION` 
DROP FOREIGN KEY `FK2OrganizationTypeID`;
ALTER TABLE `KyobeeTechRevamp`.`ORGANIZATION` 
DROP INDEX `FK2OrganizationTypeID` ,
ADD INDEX `FK2OrganizationTypeID_idx` (`OrganizationTypeID` ASC);
;
ALTER TABLE `KyobeeTechRevamp`.`ORGANIZATION` 
ADD CONSTRAINT `FK2OrganizationTypeID`
  FOREIGN KEY (`OrganizationTypeID`)
  REFERENCES `KyobeeTechRevamp`.`ORGANIZATIONTYPE` (`TypeId`);
  
  ALTER TABLE `KyobeeTechRevamp`.`USER` 
CHANGE COLUMN `UserName` `UserName` VARCHAR(255) NULL ;

ALTER TABLE `KyobeeTechRevamp`.`USER` 
CHANGE COLUMN `ActivationID` `ActivationCode` VARCHAR(100) NULL DEFAULT NULL ;

ALTER TABLE `KyobeeTechRevamp`.`GUESTMARKETINGPREFERENCESRESET` 
CHANGE COLUMN `GUEST_MARKETING_PREF_RESET_ID` `gusetMarketingPrefResetId` INT(11) NOT NULL AUTO_INCREMENT ,
CHANGE COLUMN `PREF_ID` `prefId` INT(11) NOT NULL ,
CHANGE COLUMN `GUEST_ID` `guestId` INT(11) NULL DEFAULT NULL ;

DROP TABLE `KyobeeTechRevamp`.`address`;

ALTER TABLE `KyobeeTechRevamp`.`GUEST` 
DROP COLUMN `marketingPreference`;


ALTER TABLE `KyobeeTechRevamp`.`GUESTRESET` 
DROP COLUMN `marketingPreference`;


ALTER TABLE `KyobeeTechRevamp`.`PLAN` 
CHANGE COLUMN `Active` `Active` BIT(1) NOT NULL AFTER `PLANNAME`;
  

ALTER TABLE `KyobeeTechRevamp`.`GUESTMARKETINGPREFERENCES` 
DROP FOREIGN KEY `FK1_GUESTID`;
ALTER TABLE `KyobeeTechRevamp`.`GUESTMARKETINGPREFERENCES` 
CHANGE COLUMN `GUEST_MARKETING_PREF_ID` `GuestMarketingPrefId` INT(11) NOT NULL AUTO_INCREMENT ,
CHANGE COLUMN `PREF_ID` `PrefId` INT(11) NOT NULL ,
CHANGE COLUMN `GUEST_ID` `GuestId` INT(11) NULL DEFAULT NULL ;
ALTER TABLE `KyobeeTechRevamp`.`GUESTMARKETINGPREFERENCES` 
ADD CONSTRAINT `FK1_GUESTID`
  FOREIGN KEY (`GuestId`)
  REFERENCES `KyobeeTechRevamp`.`GUEST` (`guestID`)
  ON DELETE NO ACTION
  ON UPDATE NO ACTION;
ALTER TABLE `KyobeeTechRevamp`.`GUESTMARKETINGPREFERENCESRESET` 
CHANGE COLUMN `gusetMarketingPrefResetId` `GusetMarketingPrefResetId` INT(11) NOT NULL AUTO_INCREMENT ,
CHANGE COLUMN `prefId` `PrefId` INT(11) NOT NULL ,
CHANGE COLUMN `guestId` `GuestId` INT(11) NULL DEFAULT NULL ;


ALTER TABLE `KyobeeTechRevamp`.`GUESTMARKETINGPREFERENCES` 
ADD COLUMN `CreatedBy` VARCHAR(100) NULL DEFAULT NULL AFTER `GuestId`,
ADD COLUMN `CreatedAt` DATE NULL DEFAULT NULL AFTER `CreatedBy`,
ADD COLUMN `ModifiedBy` VARCHAR(100) NULL DEFAULT NULL AFTER `CreatedAt`,
ADD COLUMN `ModifiedAt` DATE NULL DEFAULT NULL AFTER `ModifiedBy`,
CHANGE COLUMN `GuestMarketingPrefId` `GuestMarketingPrefID` INT(11) NOT NULL AUTO_INCREMENT ;


ALTER TABLE `KyobeeTechRevamp`.`GUESTMARKETINGPREFERENCESRESET` 
ADD COLUMN `CreatedBy` VARCHAR(100) NULL DEFAULT NULL AFTER `GuestId`,
ADD COLUMN `CreatedAt` DATE NULL DEFAULT NULL AFTER `CreatedBy`,
ADD COLUMN `ModifiedBy` VARCHAR(45) NULL DEFAULT NULL AFTER `CreatedAt`,
ADD COLUMN `ModifiedAt` DATE NULL DEFAULT NULL AFTER `ModifiedBy`;
 

ALTER TABLE `KyobeeTechRevamp`.`USER` 
CHANGE COLUMN `AddressId` `AddressId` INT(11) NULL DEFAULT NULL AFTER `Email`,
CHANGE COLUMN `ActivationCode` `ActivationCode` VARCHAR(100) NULL DEFAULT NULL AFTER `AuthCode`,
CHANGE COLUMN `ActivationExpiryDate` `ActivationExpiryDate` DATETIME NULL DEFAULT NULL AFTER `ActivationCode`;


ALTER TABLE `KyobeeTechRevamp`.`GUESTMARKETINGPREFERENCESRESET` 
ADD COLUMN `CreatedBy` VARCHAR(100) NULL AFTER `GuestID`,
ADD COLUMN `CreatedAt` DATE NULL AFTER `CreatedBy`,
ADD COLUMN `ModifiedBy` VARCHAR(100) NULL AFTER `CreatedAt`,
ADD COLUMN `ModifiedAt` DATE NULL AFTER `ModifiedBy`,
CHANGE COLUMN `PrefId` `PrefID` INT(11) NOT NULL ,
CHANGE COLUMN `GuestId` `GuestID` INT(11) NULL DEFAULT NULL ;

ALTER TABLE `KyobeeTechRevamp`.`GUESTMARKETINGPREFERENCESRESET` 
CHANGE COLUMN `GusetMarketingPrefResetId` `GusetMarketingPrefResetID` INT(11) NOT NULL AUTO_INCREMENT ;


ALTER TABLE `KyobeeTechRevamp`.`GUESTMARKETINGPREFERENCES` 
DROP FOREIGN KEY `FK1_GUESTID`;
ALTER TABLE `KyobeeTechRevamp`.`GUESTMARKETINGPREFERENCES` 
CHANGE COLUMN `PrefId` `PrefID` INT(11) NOT NULL ,
CHANGE COLUMN `GuestId` `GuestID` INT(11) NULL DEFAULT NULL ;
ALTER TABLE `KyobeeTechRevamp`.`GUESTMARKETINGPREFERENCES` 
ADD CONSTRAINT `FK1_GUESTID`
  FOREIGN KEY (`GuestID`)
  REFERENCES `KyobeeTechRevamp`.`GUEST` (`guestID`)
  ON DELETE NO ACTION
  ON UPDATE NO ACTION;

ALTER TABLE `KyobeeTechRevamp`.`ORGANIZATION` 
DROP COLUMN `ScreensaverFileName`,
DROP COLUMN `ScreensaverFlag`,
DROP COLUMN `smsRouteNo`,
DROP COLUMN `smsRoute`,
DROP COLUMN `CheckinSpecialNote`,
DROP COLUMN `CheckinSpecialAvailable`,
CHANGE COLUMN `DefaultLangId` `DefaultLangId` INT(10) NULL DEFAULT NULL AFTER `StripeCustomerID`,
CHANGE COLUMN `OrganizationPromotionalCode` `OrganizationPromotionalCode` VARCHAR(255) NULL DEFAULT NULL AFTER `logoFileName`,
CHANGE COLUMN `NotifyFirstFlag` `NotifyFirstFlag` CHAR(1) NULL DEFAULT 'Y' AFTER `OrganizationPromotionalCode`,
CHANGE COLUMN `TotalWaitTime` `TotalWaitTime` INT(10) NULL DEFAULT NULL AFTER `NotifyFirstFlag`,
CHANGE COLUMN `smsSignature` `smsSignature` VARCHAR(100) NULL DEFAULT NULL AFTER `TotalWaitTime`,
CHANGE COLUMN `MaxParty` `MaxParty` INT(10) NULL DEFAULT NULL AFTER `smsSignature`,
CHANGE COLUMN `Active` `Active` TINYINT(1) NOT NULL AFTER `MaxParty`;


ALTER TABLE `KyobeeTechRevamp`.`ORGANIZATION` 
DROP FOREIGN KEY `FKD063D53312C5AA27`;
ALTER TABLE `KyobeeTechRevamp`.`ORGANIZATION` 
DROP INDEX `ActiveOrganizationPlanId` ;
;



