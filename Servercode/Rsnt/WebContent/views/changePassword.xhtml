<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:s="http://jboss.com/products/seam/taglib"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:ajax="https://ajax4jsf.dev.java.net/ajax"
	xmlns:rich="http://richfaces.org/rich"
	 template="../layout/accountTemplate.xhtml">
	
	<ui:define name="head">
		<script type="text/javascript"> //<![CDATA[
		function addSafeDataValidation() {
			
			$jquery( "#passwordForm").validate({
			  debug : true,
		      rules: {
			      "passwordForm:oldPassword": { 
			    	required: true,
			    	
			      },
			      "passwordForm:newPassword": { 
		        	required: true
			      },
			      "passwordForm:confirmPassword": { 
			        	required: true,
			        	 equalTo: "#passwordForm\\:newPassword"
				      },
			     
		      },
		      highlight: function(label) {
			    //$jquery(label).closest('.control-group').addClass('error');
			  },
			  success: function(label) {
				  label
			      .addClass('validImg')
			      .closest('.control-group').addClass('success');
			  },
			  messages :{
				  confirmPassword : {
					  equalTo: "password fields have to match"
				  }
			  }
			  
		  });
		}

		$jquery(document).ready(function(){

			setupLeftMenu();

			setSidebarHeight();
			
			addSafeDataValidation();

			 updateActiveMenuItem('#spnAccnts');
			 updateActiveMenuItem('#spnChgPass');
		});

		function changePasswordJS(){
			if($jquery( "#passwordForm").valid()){
				changePassword();
			}
			
			return $jquery( "#passwordForm").valid();


		}

		 //]]>  </script>
	
	</ui:define> 
	
	 
	 <ui:define name="body">
	 
		<div class="box round first">		
			<h2>Change Password</h2>
			<br/>
				<rich:messages infoClass="rich-messages-label-sucess" errorClass="rich-messages-label-error" id="errorMsg" globalOnly="true"/>	
			<br/>
			<a4j:outputPanel id="changePasswordPanelId">
				<h:form id="passwordForm">
					<table id="changePasswordTable" class="form">
				  			<tr>
				  				<td class="col1"><label>User Name: </label></td>
				  				<td class="col2">
				  				    <h:outputText value="#{loginUser.userName}" styleClass="medium"/>
				  				</td>
				  			</tr>
				  			<tr>
				  				<td class="col1">
									<label class="control-label" for="oldPassword">Current Password:</label>
								</td>
				  				<td class="col2">
				  					<h:inputSecret value="#{changePasswordAction.oldPassword}" id="oldPassword"/>
				  				</td>
				  			</tr>
				  			<tr>
				  				<td class="col1">
									<label class="control-label" for="newPassword">New Password:</label>
								</td>
				  				<td class="col2">
				  					<h:inputSecret value="#{changePasswordAction.newPassword}" id="newPassword"/>
				  				</td>
				  			</tr>
				  			
				  			<tr>
				  				<td class="col1">
									<label class="control-label" for="newPassword">Confirm Password:</label>
								</td>
				  				<td class="col2">
				  					<h:inputSecret value="#{changePasswordAction.confirmPassword}" id="confirmPassword"/>
				  				</td>
				  			</tr>
				  			
							<tr>
					        	<td class="buttonRow">
					             	<input type="button" class="button" value="Change Password" onclick="changePasswordJS();"/>
					             	<a4j:jsFunction name="changePassword" action="#{changePasswordAction.changePassword}"  reRender="errorMsg" limitToList="true">
					             	</a4j:jsFunction>
					          	</td>
			  				</tr>
					</table>
				</h:form>
			</a4j:outputPanel>
		</div>	
	</ui:define>
</ui:composition>