<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:s="http://jboss.com/products/seam/taglib"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:ajax="https://ajax4jsf.dev.java.net/ajax"
	xmlns:rich="http://richfaces.org/rich"
	 template="../layout/template.xhtml">
<ui:define name="head">
  <style type="text/css">
div.dttt_container { float: left; }
.button { border: 1px solid #15498B; border-radius: 13px; color: #15498B; font-weight: 700; }
</style>
  <script type="text/javascript"> //<![CDATA[

		var layoutDataViewTable;
		
		$jquery(document).ready(function(){
			
			
			layoutDataViewTable= $jquery('#layoutDataTableId').dataTable({
				"sScrollY": "400px",
		    	"sScrollX": "100%",
		    	"bScrollCollapse": true,
		    	"bPaginate": true,
		    	"iDisplayLength": 100,
		    	"bFilter" : true,
		    	"bAutoWidth": true,
		    	"sAjaxSource" : RSNT_GLOBALCONTEXTPATH + RSNT_RESTEASYPATH +"/layoutManagerRestAction/loadLayoutData",
		    	 "aoColumnDefs": [{
		        	  "aTargets": ["_all"],
		        	  "bUseRendered": false
		        	}, {"bSortable" :false, "aTargets": [ 0 ]}],
		        "aoColumns": [	
		                      { "mDataProp": "orgLayoutId" , sDefaultContent: "",
								  "mRender": function (val, type, row) {
		                              return getEditImage(val,row);  }
									},		                      
								  { "mDataProp": "description", sDefaultContent: "", "mRender": 
									  function(data,type,full) {
										var str = '<a class="description">' +data+ '</a>';
										return str; 
									  }
								   },
								   {"mDataProp": "layoutCapacity", sDefaultContent: ""},
								   {"mDataProp": "isDefault", sDefaultContent: ""},
								   {"mDataProp": "createdBy", sDefaultContent: ""},
								   {"mDataProp": "createdAt", sDefaultContent: ""},
								   { "mDataProp": "activeFlag", sDefaultContent: "",
			                        	  "mRender": function (val, type, full) {
											  if(val=='Y'){
												  	var str = '<div class="active1-div"></div>';
													return str;
												  }
											  else{
												  var str = '<div class="active1-div-off"></div>';
													return str;
												  }
											     
				                              }
			                          
			                          }
								  
		                    ],
		      
	   	       "fnRowCallback" : function(nRow, aData, iDisplayIndex){
					$jquery(nRow).attr("id",aData.orgLayoutId);
					return nRow;
				},
		        
			});

			$jquery(".description").live('click', function(){
				console.log("Desciption Clicked");
					var layoutId = $jquery(this).closest("tr").attr("id");
					loadLayoutTableData(layoutId);

			});

			$jquery('.editImage').live('click', function() { 
				var id = $jquery(this).attr('id');
				editLayoutJS(id);
			});

			document.getElementById('layoutDataTableId_paginate').style.visibility = "hidden";
			updateActiveMenuItem('#spnLyt');
		});

		function openCreateLayoutInputDialog(){
			$jquery("#createLayoutInputDiv").dialog({
				autoOpen: true,
				height: 400,
			    width: 550,
			    modal: true,
			    show: "clip",
			    hide: "clip",
			    dialogClass: "noTitleStuff"
			    

			});
			document.getElementById('createLayoutInputDiv').style.visibility = "visible";
			$jquery("#createLayoutInputDiv").css("height", "");

		}

		function submitForm(){
			 var link = document.getElementById("layoutTableDataForm:loadLayoutTableDataLink");
			   var finalLink = link.href;
			   window.location = finalLink;
		}

		function saveLayoutJS(){
			if ($jquery("#createLayoutForm").valid()) {
					saveLayoutAction();
			}
			return $jquery( "#createLayoutForm").valid();
		}	

		function reloadLayoutData() {
			console.log('Reload Called');
			layoutDataViewTable.fnReloadAjax();
		}
		

		function addSafeDataValidation() {
			$jquery( "#createLayoutForm").validate({
				  debug : true,
			      rules: {
				      "createLayoutForm:layoutName": { 
				    	required: true
				      },
				      "createLayoutForm:numberOfTables": { 
			        	required: true,
			        	number:true
				      }
			      },
			      highlight: function(label) {
			  	    //$jquery(label).closest('.control-group').addClass('error');
			  	  },
			  	  success: function(label) {
			  		 label
				      .addClass('validImg')
				      .closest('.control-group').addClass('success');
			  	  }
			});
			
				      
		}
		function downloadLayoutQRCodeJS(layoutId){
			var link = document.getElementById("layoutTableDataForm:downloadQRCodeLayoutLink");
			var finalLink = link.href;
			finalLink += "&layoutId=" + layoutId;
			window.location = finalLink;

		}
	
		 //]]>  </script>
</ui:define>
<ui:define name="body">
<div class="box round first">
  <h2>Layouts</h2>
  <a4j:outputPanel rendered="#{s:hasPermission('','Create Layout')}">
    <div class="add-button"> <a href="#" onclick="createLayout();"></a> </div>
  </a4j:outputPanel>
  <h:form id="layoutTableDataForm">
    <div class="dataTables_wrapper" id="layoutDataDiv">
      <table id="layoutDataTableId" class="data display datatable">
        <thead>
          <tr>
            <th class="sorting_asc" rowspan="1" colspan="1">Action</th>
            <th class="sorting" rowspan="1" colspan="1">Description</th>
            <th class="sorting" rowspan="1" colspan="1" >Capacity</th>
            <th class="sorting" rowspan="1" colspan="1">Default</th>
            <th class="sorting" rowspan="1" colspan="1" >Created By</th>
            <th class="sorting" rowspan="1" colspan="1">Created At</th>
            <th class="sorting" rowspan="1" colspan="1" >Active</th>
          </tr>
        </thead>
        <tbody>
        </tbody>
        <tfoot>
        </tfoot>
      </table>
  <!--     <div class="dataTables_paginate paging_two_button" id="example_paginate">
        <div class="paginate_disabled_previous" title="Previous" id="example_previous"></div>
        <div class="paginate_enabled_next" title="Next" id="example_next"></div>
      </div> -->
      <div class="dataTables_paginate paging_two_button" id="example_paginate">
          <a class="paginate_disabled_previous" tabindex="0" role="button" id="example_previous" aria-controls="waitlisttable">Previous</a>
          <a class="paginate_disabled_next" tabindex="0" role="button" id="example_next" aria-controls="waitlisttable">Next</a>
       </div>
    </div>
    <a4j:jsFunction name="createLayout" action="#{layoutManagerAction.initialize}" oncomplete="openCreateLayoutInputDialog();addSafeDataValidation();" 
				reRender="createLayoutInputDialogPanelId22,editLayoutNoMPanel,editLayoutNoMPanel1"> </a4j:jsFunction>
    <a4j:jsFunction name="loadLayoutTableData" oncomplete="submitForm()" reRender="layoutMarkerHeaderPanel">
      <a4j:actionparam name="param1" assignTo="#{layoutManagerAction.selectedOrgLayoutId}" />
    </a4j:jsFunction>
    <a4j:jsFunction name="editLayoutJS" oncomplete="addSafeDataValidation();openCreateLayoutInputDialog();" action="#{layoutManagerAction.initializeEditLayout}"  
				reRender="createLayoutInputDialogPanelId22,editLayoutNoMPanel,editLayoutNoMPanel1">
      <a4j:actionparam name="param1" assignTo="#{layoutManagerAction.addEditOrganizationLayoutId}" />
    </a4j:jsFunction>
    <s:link id="loadLayoutTableDataLink" view="/views/layoutMarkerData.xhtml"  action="#{layoutManagerAction.loadLayoutData()}"> </s:link>
    <s:link id="downloadQRCodeLayoutLink" action="#{layoutManagerAction.startDownloadPdf(true)}" style="visibility:hidden; display:none;" />
  </h:form>
</div>
<div id="createLayoutInputDiv" class="lbOuterContainer grey" style="border-radius: 8px; padding-bottom: 10px; padding-top: 14px; border: 2px solid #E3862C; 
												background-color: #42030C;
												 margin: 0 auto;position: relative;color: #C2C2C2;visibility: hidden">
  <div id="lbIframeContainer" class="light-box" style="padding: 4px">
    <h2 style="margin-top: 1em;line-height: 1.2em;margin-bottom: 0.3em;text-align: center;" >Rename Layout</h2>
    <rich:messages infoClass="info" errorClass="error" id="addLayoutErrorMsg" globalOnly="true" ajaxRendered="false"/>
    <a4j:outputPanel id="createLayoutInputDialogPanelId22">
      <h:form id="createLayoutForm">
        <table class="form">
          <tr>
            <td class="col1" style="width:30%; text-align: right;padding-right: 5px;"><span style="font-weight: bold;font-family:Tahoma,​Geneva,​sans-serif;font-size:12.8667px;color:#000000;line-height: 1.2em;text-align: left">Layout Name:</span> <span class="required">*</span></td>
            <td class="col2"><h:inputText styleClass="medium" id="layoutName" label="title3" value="#{layoutManagerAction.addEditOrgLayoutName}"> </h:inputText></td>
          </tr>
          <tr>
            <td class="col1" style="text-align: right;padding-right: 5px;"><span style="font-weight: bold;font-family:Tahoma,​Geneva,​sans-serif;font-size:12.8667px;color:#000000;line-height: 1.2em;text-align: left">Default:</span> <span class="required">*</span></td>
            <td class="col2"><h:selectBooleanCheckbox value="#{layoutManagerAction.layoutDefaultFlag}" /></td>
          </tr>
          <tr>
            <td class="col1" style="text-align: right;padding-right: 5px;"><span style="font-weight: bold;font-family:Tahoma,​Geneva,​sans-serif;font-size:12.8667px;color:#000000;line-height: 1.2em;text-align: left">Active:</span> <span class="required">*</span></td>
            <td class="col2"><h:selectBooleanCheckbox value="#{layoutManagerAction.layoutActiveFlag}" /></td>
          </tr>
          <tr>
            <td class="col1" style="text-align: right;padding-right: 5px;"><a4j:outputPanel id="editLayoutNoMPanel1" rendered="#{layoutManagerAction.editLayoutMode==false}"> <span style="font-weight: bold;font-family:Tahoma,​Geneva,​sans-serif;font-size:12.8667px;color:#000000;line-height: 1.2em;text-align: left">Number of Markers:</span> <span class="required">*</span> </a4j:outputPanel></td>
            <td class="col2"><a4j:outputPanel id="editLayoutNoMPanel" rendered="#{layoutManagerAction.editLayoutMode==false}">
                <h:inputText styleClass="medium" id="numberOfTables" label="title" value="#{layoutManagerAction.numberofTables}"> </h:inputText>
              </a4j:outputPanel></td>
          </tr>
        </table>
        <table class="form">
          <tr>
            <td class="buttonRow" colspan="10" style="text-align: right"><a4j:outputPanel rendered="#{s:hasPermission('','Edit Layout')}">
                <input type="button" class="button" onclick="saveLayoutJS()" value="Save" name="Save"/>
              </a4j:outputPanel>
              <a4j:commandButton action="#{layoutManagerAction.cancelEditOrgLayout}" oncomplete="closeDialog('#createLayoutInputDiv')" value="Cancel" 
					             		status="showLoadingStatus" reRender="addLayoutErrorMsg" styleClass="button"  > </a4j:commandButton>
              <a4j:jsFunction name="saveLayoutAction" action="#{layoutManagerAction.saveLayoutHeader}" status="showLoadingStatus" 
					             	oncomplete=" if(#{layoutManagerAction.createLayoutValid}) 
				            		{
				            			closeDialog('#createLayoutInputDiv');
				            			reloadLayoutData();
				            			
				            		} " reRender="addLayoutErrorMsg" limitToList="true"> </a4j:jsFunction>
              <a4j:jsFunction name="cancelLayoutAction" action="#{layoutManagerAction.cancelEditOrgLayout}" status="showLoadingStatus" 
					             		oncomplete="closeDialog('#createLayoutInputDiv');" reRender="addLayoutErrorMsg" limitToList="true" > </a4j:jsFunction></td>
          </tr>
        </table>
      </h:form>
    </a4j:outputPanel>
  </div>
  <div id="lbBottomContainer" class="grey" style="border-radius: 8px; display: block;">
    <div id="lbBottomData" class="grey"> <span id="lbTitleBottom"></span><span id="lbNumBottom"></span> <span id="lbDescBottom" style="display: none;"></span> </div>
    <div id="lbBottomNav"> <a id="lbClose" title="Close (Esc)" class="grey" href="javascript:void(0)" style="display: none;"></a> </div>
  </div>
</div>
</ui:define>
</ui:composition>