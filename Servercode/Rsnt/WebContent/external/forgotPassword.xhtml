<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:s="http://jboss.com/products/seam/taglib"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:ajax="https://ajax4jsf.dev.java.net/ajax"
	xmlns:rich="http://richfaces.org/rich"
	 template="../layout/externalTemplate.xhtml">
	
	<ui:define name="head">
		<script>
		function addSafeDataValidation() {
			
			$jquery( "#forgotPasswordForm").validate({
			  debug : true,
		      rules: {
			      "forgotPasswordForm:emailId": { 
			    	required: true,
			    	email : true
			    	
			      },
			      
		      },
		      highlight: function(label) {
			    $jquery(label).closest('.control-group').addClass('error');
			  },
			  success: function(label) {
			    label
			      .text('OK!').addClass('valid')
			      .closest('.control-group').addClass('success');
			  },
		  });
		}

		$jquery(document).ready(function(){
			addSafeDataValidation();

			$jquery("#passwordInfoDiv").dialog({
    			autoOpen: false,
    			height: 'auto',
    			width: 'auto',
    				modal: true,
    			show: "clip",
    			hide: "clip"
    		});	
    		
		});

		function getPasswordJS(){
			if($jquery( "#forgotPasswordForm").valid()){
				getPassword();
			}
			
			return $jquery( "#forgotPasswordForm").valid();
		}
		function openForgotPasswordInfoPanel() {
			$jquery("#passwordInfoDiv").dialog( "open" );
		}

		function openForgotPasswordErrorPanel() {
			$jquery("#passwordErrorDiv").dialog( "open" );
		}
		function closeForgotPasswordInfoPanel(){
			$jquery("#passwordInfoDiv").dialog( "close" );
		}	
		function closeForgotPasswordErrorPanel(){
			$jquery("#passwordErrorDiv").dialog( "close" );
		}		
			
	

		</script>
	
	</ui:define> 
	
	 
	 <ui:define name="body">
		 <div class="box round first">	
	 	 <h2>RESET YOUR PASSWORD</h2>
		<br/>
		<rich:messages infoClass="info" errorClass="error" id="errorMsg" globalOnly="true"/>	
		<br/>
	 	<a4j:outputPanel id="forgotPasswordPanelId">
				
	    	 <h:form id="forgotPasswordForm">
		     	<div>
					<table id="changePasswordTable"  class="form">
			  			<tr>
		  					<td class="col1" >
								<label class="control-label" for="emailId">Enter your registered Email Id:</label>
							</td>
							<td class="col2">
								<h:inputText id="emailId" value="#{forgotPasswordAction.emailId}" />
							</td>
			  			</tr>
  					</table>
		  			<table>
						<tr>
				        	<td class="buttonRow" style="text-align: right">
				             	<input type="button" class="button" value="Send Reset Password Link" onclick="getPasswordJS();"/>
				             	<a4j:jsFunction name="getPassword" action="#{forgotPasswordAction.emailPasswordLink}"  reRender="errorMsg" status="showLoadingStatus"
				             	   oncomplete="if(#{forgotPasswordAction.forgotPasswordValid}){
				             	   	
				             	   		openForgotPasswordInfoPanel();
				             	   
				             	   }	
				             	   else {
				             	   		openForgotPasswordErrorPanel();
				             	   }"
				             	   limitToList="true">
				             	</a4j:jsFunction>
				          	</td>
		  				</tr>
					</table>
				</div>
			 </h:form>
				
		</a4j:outputPanel>
		</div>
		<div id="passwordInfoDiv" title="Important!!"  style="display:none;width=160px">
		     <a4j:outputPanel id="forgotPasswordInfoPanel">
		     	<table cellspacing="10" cellpadding="0" width="100%">
							<tr>
								<td colspan="2" style="color: maroon; white-space: normal">
									<fieldset style="text-align: center; font-size: 11px; border-color: maroon; margin-bottom: 15px">
										<h:outputText id="custNo" styleClass="label" value="The Link to reset your password has been successfully emailed.">
										</h:outputText>
										<br />
									</fieldset>
								</td>
							</tr>
							<tr>
								<td>
									<input type="button" class="button" value="OK" onclick="closeForgotPasswordInfoPanel();" />
								</td>
							</tr>
					</table>
		     	<br/>
			</a4j:outputPanel>
				
			</div>
			
			<div id="passwordErrorDiv" title="Important!!"  style="display:none;width=160px">
		     <a4j:outputPanel id="forgotPasswordErrorPanel">
		     	<table cellspacing="10" cellpadding="0" width="100%">
							<tr>
								<td colspan="2" style="color: maroon; white-space: normal">
									<fieldset style="text-align: center; font-size: 11px; border-color: maroon; margin-bottom: 15px">
										<h:outputText id="custNoErr" styleClass="label" value="Unable to determine your account. Please contact System Administrator">
										</h:outputText>
										<br />
									</fieldset>
								</td>
							</tr>
							<tr>
								<td>
									<input type="button" class="button" value="OK" onclick="closeForgotPasswordErrorPanel();" />
								</td>
							</tr>
					</table>
		     	<br/>
			</a4j:outputPanel>
				
			</div>	
		</ui:define>
	 </ui:composition>